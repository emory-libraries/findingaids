{# display common series information - expects finding aid component as series #}
{% load ead %}
<h2 class="{{ series.level }}">
  <a name="{{ series.short_id }}">
      {{ series.did.unitid }} <br/>
      {{ series.did.unittitle|format_ead  }}
      {% if series.did.unitdate and series.did.unitdate not in series.did.unittitle %}
        {{ series.did.unitdate }}
      {% endif %}
       <br/>
      {{ series.did.physdesc|default:'' }}
  </a>
</h2>

{# TODO: shift some of this semantic logic to the view? case-insensitive comparison ? #}
{% if 'correspondence' in series.did.unittitle|format_ead|slugify and series.ead.origination_name.authfilenumber|default:'' %}
  {% with name=series.ead.origination_name %}
  <div typeof="{% if name.is_person %}schema:Person{% elif name.is_corporate %}schema:Organization{% endif %}" about="{{ series.ead.origination_name.uri}}">
  {% endwith %}
{% endif %}

{% for section in series.series_info %}

{% series_section_rdfa series section as divinfo %}
{{ divinfo.start }} {# start tag, with any semantic information determined by series_section_rdaf #}
   	<h3>{{ section.head|default:'' }}</h3>
	{% for para in section.content %}
     {% if use_rdfa %}
       <p>{{ para|format_ead_rdfa:default_rel }}</p>
     {% else %}
    	 <p>{{para|format_ead}}</p>
     {% endif %}
	{% endfor %}
{{ divinfo.end }}
{% endfor %}

{# container list or series/subseries listing #}
{% if series.hasSubseries %}
  {% if subseries %}  {# if list of subseries links is defined (unused in full/pdf view #}
    <hr/>
    <h3>Description of Subseries</h3>
        <ul>
           {% autoescape off %}
               {{ subseries|unordered_list }}
           {% endautoescape %}
        </ul>

      {% if subseries_noparam %} {# urls for RDFa without keyword args #}
      <ul class="series-list" style="display:none">
        {% autoescape off %}
           {{ subseries_noparam|unordered_list }}
        {% endautoescape %}
      </ul>
      {% endif %}

    {% endif %}
{% else %}

{% if 'correspondence' in series.did.unittitle|format_ead or 'Correspondence' in series.did.unittitle|format_ead and series.ead.origination_name.authfilenumber %}
  {% with rdfa_rel="schema:knows arch:correspondedWith" %}
    {% include "fa/snippets/containerlist.html" %}
  {% endwith %}
{% else %}
  <div rel="schema:about">
    {# the series description, like the main finding aid document is *about* the archival collection #}
    <div about="{{ ead.collection_uri }}"> {# typeof="schema:CreativeWork arch:Collection dcmitype:Collection"> #}
      {# FIXME: are types needed here? or redundant since they are on main findingaid page? #}
      {% include "fa/snippets/containerlist.html" %}
    </div>
  </div>
{% endif %}
{% endif %}

{% if 'correspondence' in series.did.unittitle|format_ead or 'Correspondence' in series.did.unittitle|format_ead and series.ead.origination_name.authfilenumber %}
  </div>
{% endif %}

