{# list recently modified source EAD files #}
<div class="section">

<h2>Recently modified files</h2>

{% if error %}<p class="error">Error: {{ error }}</p>{% endif %}

<div>{{ files.paginator.count }} files total</div>
{% with files as items %}
    {% include "snippets/pagination.html" %}
{% endwith %}
<table>
    <tr>
        <th colspan="3">Filename</th> {# spans columns for [publish,] preview, & prep #}
        <th>Last Modified</th>
        <th>Last Published</th>
        <th>Available for<br/>Preview</th>
    </tr>
{% for file in files.object_list %}
    <tr>
        <td>{{ file.filename }}</td>
        <td><a class="admin-action"
            href="{% url 'fa-admin:prep-ead-about' file.filename %}{% if file.archive %}?archive={{ file.archive.slug }}{% endif %}">PREP</a></td>
        <td>
            {% if perms.fa_admin.can_preview %}
            <form action="{% url 'fa-admin:preview-ead' %}" method="post">{% csrf_token %}
                {% if file.archive %}<input type="hidden" name="archive" value="{{ file.archive.slug }}"/>{% endif %}
                <button type="submit" name="filename" value="{{ file.filename }}" class="admin-action">PREVIEW</button>
            </form>
            {% endif %}
        </td>
{% comment %} publish temporarily disabled while assessing workflow (publish from preview only)
        <td>
            {% if perms.fa_admin.can_publish %}
            <form action="{% url 'fa-admin:publish-ead' %}" method="post">{% csrf_token %}
                <button type="submit" name="filename" value="{{ file.filename }}" class="admin-action">PUBLISH</button>
            </form>
            {% endif %}
        </td> {% endcomment %}
        <td>{{ file.modified|date }}</td>
        <td>{{ file.published|date|default:'' }}</td>
        <td>{{ file.previewed|date|default:'' }}</td>
    </tr>
{% empty %}
  <tr><td colspan="2">No files found</td></tr>
{% endfor %}
</table>

{% with files as items %}
    {% include "snippets/pagination.html" %}
{% endwith %}

</div>